function newgame(){var t;for(t=0;gridy>t;++t)mines[t]=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],shown[t]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var d;for(d=0;maxmines>d;++d){var i,b;do i=Math.floor(Math.random()*gridx),b=Math.floor(Math.random()*gridy);while(mines[b][i]);mines[b][i]=!0}squaresleft=gridy*gridx,flagsleft=maxmines,elapsedtime=0,playing=!0,clicked=!1,placeflag=!1,buildgrid(),setInterval("ticker()",1e3)}function ticker(){playing&&clicked&&(elapsedtime++,setStatus())}function setStatus(){document.images.elapse3.src=num[elapsedtime-10*Math.floor(elapsedtime/10)].src,document.images.elapse2.src=num[Math.floor((elapsedtime-100*Math.floor(elapsedtime/100))/10)].src,document.images.elapse1.src=num[Math.floor(elapsedtime/100)].src,document.images.flag3.src=num[flagsleft-10*Math.floor(flagsleft/10)].src,document.images.flag2.src=num[Math.floor((flagsleft-100*Math.floor(flagsleft/100))/10)].src,document.images.flag1.src=num[Math.floor(flagsleft/100)].src}function buildgrid(){document.write("<!-- Window --><DIV align=center id='mswp-container'> <!-- Top Bar --> <table width="+totalWidth+" border=0 cellspacing=0 cellpadding=0> <tr bgcolor=#bbbbbb height=1> <td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#bbbbbb></td><td width="+tW6+" bgcolor=#bbbbbb></td> <td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#000000></td></tr><tr height=1><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#ffffff></td><td width=1 bgcolor=#ffffff></td><td bgcolor=#ffffff></td><td width=1 bgcolor=#ffffff></td><td width=1 bgcolor=#888888></td><td width=1 bgcolor=#000000></td></tr><tr height=1><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#ffffff></td><td width=1 bgcolor=#bbbbbb></td><td bgcolor=#bbbbbb></td><td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#888888></td><td width=1 bgcolor=#000000></td></tr></table><!-- Title --><table border=0 cellspacing=0 cellpadding=0><tr height=18><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#ffffff></td><td width=1 bgcolor=#bbbbbb></td><td bgcolor=#000088 width=134><img src='title.gif'><img src='a.gif' height=1 width="+topBarWidth+" name='titleBarEmptySpace'></td><td><img id='minesweeper-close-btn' src='close.gif'></td><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#888888></td><td width=1 bgcolor=#000000></td></tr></table><table width="+totalWidth+" border=0 cellspacing=0 cellpadding=0> <tr height=33> <td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#ffffff></td> <td width=1 bgcolor=#bbbbbb></td> <td><img src='cplleft.gif' height=33 width=11></td> <td> <!-- Control Panel --> <table width="+ww2+" border=0 cellspacing=0 cellpadding=0><tr height=4 width="+ww2+"><td bgcolor=#bbbbbb></td></tr></table> <table width="+ww2+" border=0 cellspacing=0 cellpadding=0><tr height=26><td width=5 bgcolor=#bbbbbb></td><td><!-- Mines Remaining --> <table width=41 border=0 cellspacing=0 cellpadding=0><tr bgcolor=#888888><td></td><td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td width=1 bgcolor=#bbbbbb></td></tr> <tr bgcolor=#000000> <td width=1 bgcolor=#888888></td> <td></td><td></td> <td></td><td></td><td></td><td></td><td></td> <td width=1 bgcolor=#ffffff></td></tr> <tr bgcolor=#000000> <td width=1 bgcolor=#888888></td> <td width=1 bgcolor=#000000></td> <td><img src='0.gif' name='flag1'></td><td width=2></td><td><img src='1.gif' name='flag2'></td><td width=2></td><td><img src='0.gif' name='flag3'></td><td width=1></td> <td width=1 bgcolor=#ffffff></td></tr> <tr bgcolor=#000000> <td width=1 bgcolor=#888888></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td width=1 bgcolor=#ffffff></td></tr> <tr bgcolor=#ffffff> <td width=1 bgcolor=#bbbbbb></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td></td></tr><tr bgcolor=#bbbbbb> <td width=1 bgcolor=#bbbbbb></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td></td></tr></table><!-- End Mines Remaining --> </td> <td bgcolor=#bbbbbb><img height=1 src='a.gif' width="+cplLeft+"name='cplLeft'><td><img src='btnsmile.gif' name='condition' onmousedown='document.images.condition.src=\"btnsmil2.gif\";' onmouseup='document.images.condition.src=\"btnsmile.gif\";location.reload();;'></td> <td width=4 bgcolor=#bbbbbb><img height=1 src='a.gif' width="+cplRight+"></td> <td> <!-- Elapsed Time --> <table width=41 border=0 cellspacing=0 cellpadding=0> <tr bgcolor=#888888> <td></td><td></td><td></td> <td></td><td></td><td></td><td></td><td></td> <td width=1 bgcolor=#bbbbbb></td></tr> <tr bgcolor=#000000> <td width=1 bgcolor=#888888></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td width=1 bgcolor=#ffffff></td></tr> <tr bgcolor=#000000> <td width=1 bgcolor=#888888></td> <td width=1 bgcolor=#000000></td> <td><img src='0.gif' name='elapse1'></td> <td width=2></td> <td><img src='0.gif' name='elapse2'></td> <td width=2></td> <td><img src='0.gif' name='elapse3'></td> <td width=1></td> <td width=1 bgcolor=#ffffff></td></tr> <tr bgcolor=#000000> <td width=1 bgcolor=#888888></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td width=1 bgcolor=#ffffff></td></tr> <tr bgcolor=#ffffff> <td width=1 bgcolor=#bbbbbb></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td></td></tr> <tr bgcolor=#bbbbbb> <td width=1 bgcolor=#bbbbbb></td> <td></td><td></td> <td></td><td></td><td></td> <td></td><td></td> <td></td></tr> </table> <!-- End Elapsed Time --> </td> <td width=7 bgcolor=#bbbbbb></td></tr></table><table width="+ww2+" border=0 cellspacing=0 cellpadding=0> <tr height=3><td bgcolor=#bbbbbb></td></tr></table> <!-- End Control Panel --> </td> <td><img src='cplright.gif' height=33 width=11></td> <td><img src='right.gif' height=33 width=5></td> </tr></table><!-- Separator --> <table border=0 cellspacing=0 cellpadding=0> <tr height=11 width="+totalWidth+"> <td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#ffffff></td> <td width=1 bgcolor=#bbbbbb></td> <td><img src='ml.gif'></td><td><img src='separatr.gif' width="+wideWidth+" height=11></td><td><img src='mr.gif'></td><td><img src='right.gif' width=5></td></tr></table> <!-- Mine Field --> <table width="+totalWidth+" border=0 cellspacing=0 cellpadding=0> <tr height="+highHeight+"> <td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#ffffff></td> <td width=1 bgcolor=#bbbbbb></td> <td><img src='fielside.gif' width=12 height="+highHeight+"></td> <td> <!-- Game Field -->");var t,d,i="";for(d=0;gridy>d;++d){for(t=0;gridx>t;++t)i=i+'<a href="javascript:gridclick('+d+","+t+');"><img src="'+dir+'sqt0.gif" name="grd'+d+"_"+t+'" border=0></a>';i+="<br>"}document.write(i),document.write('</td><td valign=right><img src="fielside.gif" width=12 height='+highHeight+'></td><td valign=right><img src="right.gif" width=5 height='+highHeight+"></td></tr></table><table width="+totalWidth+' border=0 cellspacing=0 cellpadding=0><tr height=12> <td width=1 bgcolor=#bbbbbb></td> <td width=1 bgcolor=#ffffff></td><td width=1 bgcolor=#bbbbbb></td> <td><img src="bl.gif"></td><td><img src="footer.gif" width='+wideWidth+' height=12></td><td><img src="br.gif"></td> <td><img src="right.gif" height=12></td></tr></table><table width='+totalWidth+" border=0 cellspacing=0 cellpadding=0><tr bgcolor=#bbbbbb height=1><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#ffffff></td><td width=1 bgcolor=#bbbbbb></td><td width="+tW6+" bgcolor=#bbbbbb></td><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#888888></td><td width=1 bgcolor=#000000></td></tr><tr height=1><td width=1 bgcolor=#bbbbbb></td><td width=1 bgcolor=#888888></td><td width=1 bgcolor=#888888></td><td bgcolor=#888888></td> <td width=1 bgcolor=#888888></td><td width=1 bgcolor=#888888></td> <td width=1 bgcolor=#000000></td> </tr> <tr height=1><td width=1 bgcolor=#000000></td> <td width=1 bgcolor=#000000></td> <td width=1 bgcolor=#000000></td><td bgcolor=#000000></td> <td width=1 bgcolor=#000000></td> <td width=1 bgcolor=#000000></td><td width=1 bgcolor=#000000></td> </tr></table></div>")}function surrounding(t,d){var i=0;return t>0&&d>0&&mines[t-1][d-1]&&i++,t>0&&mines[t-1][d]&&i++,t>0&&gridx-1>d&&mines[t-1][d+1]&&i++,d>0&&mines[t][d-1]&&i++,gridx-1>d&&mines[t][d+1]&&i++,gridy-1>t&&d>0&&mines[t+1][d-1]&&i++,gridy-1>t&&mines[t+1][d]&&i++,gridy-1>t&&gridx-1>d&&mines[t+1][d+1]&&i++,i}function rollback(t,d){if(t>=0&&gridy>t&&d>=0&&gridx>d&&3!=shown[t][d]){var i=surrounding(t,d);shown[t][d]=3,squaresleft--,document.images["grd"+t+"_"+d].src=dir+"sq"+i+".gif",0==i&&(rollback(t-1,d-1),rollback(t-1,d),rollback(t-1,d+1),rollback(t,d-1),rollback(t,d+1),rollback(t+1,d-1),rollback(t+1,d),rollback(t+1,d+1))}}function dead(){var t,d;for(t=0;gridy>t;++t)for(d=0;gridx>d;++d)mines[t][d]?1!=shown[t][d]&&(document.images["grd"+t+"_"+d].src=dir+"mine.gif"):1==shown[t][d]&&(document.images["grd"+t+"_"+d].src=dir+"nomine.gif");document.images.condition.src=dir+"btndead.gif",playing=!1,clicked=!1}function gridclick(t,d){if(playing)if(clicked=!0,placeflag){if(shown[t][d]<3){var i=shown[t][d],b=!0;1==i&&(flagsleft++,squaresleft++),0==flagsleft&&0==i?b=!1:(2==i?i=0:i++,1==i&&(flagsleft--,squaresleft--)),b&&(shown[t][d]=i,document.images["grd"+t+"_"+d].src=dir+"sqt"+i+".gif",setStatus()),0==squaresleft&&(document.images.condition.src=dir+"btncool.gif",playing=!1)}}else 1!=shown[t][d]&&(mines[t][d]?(document.images["grd"+t+"_"+d].src=dir+"minered.gif",dead()):rollback(t,d))}for(var dir="",mines=[],shown=[],gridx=8,gridy=8,maxmines=10,gridSq=16*gridx,grid8=gridSq-128,grid16=gridx-8,grid32=8*grid16,grid64=16*grid16,topBarWidth=8+grid64,menuBarWidth=86+grid64,wideWidth=16*gridx,highHeight=16*gridy,cplLeft=6+grid32,cplRight=4+grid32,totalWidth=gridSq+32,tW6=totalWidth-6,ww2=wideWidth+2,num=new Array(10),i=0;10>i;i++)num[i]=new Image,num[i].src=i+".gif";newgame(),$("#minesweeper-close-btn").on("click",function(){parent.postMessage("minesweeperClose","http://schnogz.com")});